<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technics SL-PG740A - Direct Access</title>
    <link href="https://fonts.cdnfonts.com/css/ds-digital" rel="stylesheet">
    
    <style>
        :root {
            --bg-black: #050505;
            --deck-gray: #1a1a1b;
            --vfd-blue: #40e0ff;
            --vfd-glow: rgba(64, 224, 255, 0.5);
            --vfd-blue-dim: #003a4d;
            --vfd-red: #ff3333;
            --text-silver: #a0a0a0;
            --text-white: #ffffff;
            --ui-font: 'Segoe UI', Tahoma, sans-serif;
            --digital-font: 'DS-Digital', sans-serif;
            --brushed-metal: conic-gradient(from 0deg, #222 0deg, #444 45deg, #222 90deg, #444 135deg, #222 180deg, #444 225deg, #222 270deg, #444 315deg, #222 360deg);
        }

        body {
            background-color: var(--bg-black);
            color: var(--text-silver);
            font-family: var(--ui-font);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; user-select: none;
        }

        .deck-container {
            width: 1000px; background-color: var(--deck-gray);
            padding: 15px 45px 35px 45px; border-top: 1px solid #333;
            border-radius: 4px; box-shadow: 0 60px 120px rgba(0,0,0,1);
        }

        .brand-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #222;
        }

        .main-logo { height: 70px; display: block; }
        .model-name { font-size: 11px; color: var(--text-white); letter-spacing: 2.5px; font-weight: bold; text-transform: uppercase; }

        .tray-outer-slot {
            width: 100%; height: 85px; background: #000;
            margin-bottom: 30px; position: relative; overflow: hidden; border: 1px solid #111;
        }

        .tray-mechanism {
            position: absolute; width: 100%; height: 100%;
            background: linear-gradient(180deg, #1a1a1b 0%, #151516 100%);
            top: 0; left: 0; z-index: 10;
            transition: transform 0.9s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; justify-content: center; align-items: center;
            border-bottom: 2px solid #000;
        }
        .tray-mechanism.open { transform: translateY(80px); }

        .display-panel {
            background: #000; padding: 20px 25px; border: 4px solid #111;
            box-shadow: inset 0 0 50px rgba(0,0,0,1), 0 0 15px var(--vfd-glow);
            min-height: 220px;
            display: flex; flex-direction: column;
            justify-content: space-between; box-sizing: border-box;
        }

        .vfd-main-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 5px; }
        .vfd-col-track { flex-basis: 120px; }
        .vfd-col-indicators { 
            flex: 1; display: flex; flex-direction: column; align-items: center; 
            gap: 2px; border-left: 1px solid #111; border-right: 1px solid #111;
            margin: 0 15px; padding: 5px 0;
        }
        .vfd-col-time { flex-basis: 220px; text-align: right; }

        .track-grid {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 15px 0;
            padding: 8px 0;
            border-top: 1px solid #0a0a0a;
            border-bottom: 1px solid #0a0a0a;
        }
        .grid-num {
            font-family: var(--ui-font);
            font-size: 13px;
            font-weight: bold;
            color: #111;
            transition: all 0.2s;
            min-width: 15px;
            text-align: center;
        }
        .grid-num.loaded { 
            color: #40e0ff; 
            text-shadow: 0 0 8px rgba(64, 224, 255, 0.4);
        }
        .grid-num.active-track { 
            color: #ff3333 !important; 
            text-shadow: 0 0 12px rgba(255, 51, 51, 0.9);
        }

        .vfd-indicator { font-family: var(--ui-font); font-size: 9px; font-weight: bold; color: #08181a; text-transform: uppercase; letter-spacing: 0.5px; }
        .vfd-indicator.active { color: var(--vfd-blue); text-shadow: 0 0 8px var(--vfd-blue); }
        
        @keyframes blink-vfd { 50% { opacity: 0.1; } }
        .vfd-blink { animation: blink-vfd 0.6s step-start infinite; color: var(--vfd-blue); }

        .digital-counter {
            display: flex; align-items: center; font-family: var(--digital-font); 
            font-size: 54px; font-weight: bold; color: var(--vfd-blue);
            text-shadow: 0 0 15px var(--vfd-blue-dim); line-height: 1;
        }
        .digit { width: 34px; text-align: center; }
        .digit-sign { width: 20px; text-align: center; font-size: 35px; display: none; color: var(--vfd-blue); }
        .digit-sign.visible { display: inline-block; }
        .time-separator { width: 15px; text-align: center; font-size: 35px; padding-bottom: 5px; }

        .label-vfd { font-size: 10px; color: var(--vfd-blue-dim); font-family: var(--ui-font); font-weight: bold; text-transform: uppercase; margin-bottom: 4px; display: block; letter-spacing: 1.5px;}

        .main-interface { display: grid; grid-template-columns: 100px 1fr 320px; gap: 25px; align-items: start; }
        
        .btn { 
            background: linear-gradient(145deg, #2a2a2b, #151516); border: 1px solid #111; 
            color: var(--text-silver); cursor: pointer; font-size: 11px; font-weight: bold; 
            box-shadow: 3px 3px 6px #000; text-transform: uppercase; height: 50px; width: 100%;
            display: flex; align-items: center; justify-content: center;
        }
        .btn:active { background: linear-gradient(145deg, #151516, #2a2a2b); box-shadow: inset 2px 2px 5px #000; color: var(--text-white); }
        .btn-num { height: 35px; font-size: 14px; }

        .knob { background: var(--brushed-metal); border-radius: 50%; border: 3px solid #111; cursor: pointer; box-shadow: 5px 5px 15px #000; margin: 10px auto; }
        .vol-knob { width: 65px; height: 65px; }
        .jog-knob { width: 120px; height: 120px; }

        .vu-row { display: flex; align-items: center; gap: 10px; margin-top: 5px; }
        .vu-label { color: var(--vfd-blue); font-family: var(--ui-font); font-size: 12px; font-weight: bold; width: 15px; }
        .meter-container { flex: 1; height: 8px; background: #080808; display: flex; gap: 2px; padding: 1px; }
        .meter-segment { flex: 1; background: #121212; }
        .meter-segment.on-blue { background: var(--vfd-blue); box-shadow: 0 0 5px var(--vfd-blue); }
        .meter-segment.on-red { background: var(--vfd-red); box-shadow: 0 0 5px var(--vfd-red); }
    </style>
</head>
<body>

    <div class="deck-container">
        <header class="brand-header">
            <img src="Technics_logo.png" alt="Technics" class="main-logo">
            <div class="model-name">Stereo Compact Disc Player SL-PG740A</div>
        </header>

        <div class="tray-outer-slot">
            <div id="tray-front" class="tray-mechanism">
                <span style="color: #444; font-size: 11px; font-weight: bold; letter-spacing: 3px;">MASH - Multi-Stage Noise Shaping</span>
            </div>
            <div style="position:absolute; width:100%; height:100%; display:flex; justify-content:center; align-items:center;">
                <input type="file" id="file-input" multiple style="display:none">
                <label for="file-input" style="color:#fff; cursor:pointer; font-weight:bold; letter-spacing:2px;">● INSERT COMPACT DISC ●</label>
            </div>
        </div>

        <div class="main-interface">
            <div style="text-align:center;">
                <span style="font-size:10px; color:white; font-weight:bold; text-transform:uppercase; margin-bottom:8px; display:block;">Open/Close</span>
                <button class="btn" id="eject-btn" style="width:60px; height:45px; margin: 0 auto;">⏏</button>
            </div>

            <div class="display-and-controls">
                <section class="display-panel">
                    <div class="vfd-main-row">
                        <div class="vfd-col-track">
                            <span class="label-vfd">Track</span>
                            <div class="digital-counter" id="track-counter-box">
                                <span id="t-d1" class="digit">0</span><span id="t-d2" class="digit">0</span>
                            </div>
                        </div>
                        
                        <div class="vfd-col-indicators">
                            <div id="vfd-shuffle" class="vfd-indicator">Shuffle</div>
                            <div id="vfd-repeat-1" class="vfd-indicator">Repeat 1</div>
                            <div id="vfd-repeat-all" class="vfd-indicator">Repeat All</div>
                            <div id="vfd-ab" class="vfd-indicator">A-B</div>
                            <div id="vfd-peak" class="vfd-indicator">Peak Search</div>
                        </div>

                        <div class="vfd-col-time" id="time-group">
                            <span id="time-label" class="label-vfd">Min : Sec</span>
                            <div class="digital-counter" id="main-time-display" style="justify-content: flex-end;">
                                <span id="time-sign" class="digit-sign">-</span>
                                <span id="m-d1" class="digit">0</span><span id="m-d2" class="digit">0</span>
                                <span class="time-separator">:</span>
                                <span id="s-d1" class="digit">0</span><span id="s-d2" class="digit">0</span>
                            </div>
                        </div>

                        <div class="vfd-col-time" id="vol-group" style="display: none;">
                            <span class="label-vfd">Volume</span>
                            <div class="digital-counter" style="justify-content: flex-end;">
                                <span id="v-d1" class="digit">0</span><span id="v-d2" class="digit">2</span>
                            </div>
                        </div>
                    </div>

                    <div class="track-grid" id="track-grid"></div>
                    
                    <div class="vu-meters">
                        <div class="vu-row"><span class="vu-label">L</span><div class="meter-container" id="meter-L"></div></div>
                        <div class="vu-row"><span class="vu-label">R</span><div class="meter-container" id="meter-R"></div></div>
                    </div>
                </section>

                <div style="display:grid; grid-template-columns: repeat(10, 1fr); gap:5px; margin-top:20px;">
                    <button class="btn btn-num" onclick="numJump(1)">1</button>
                    <button class="btn btn-num" onclick="numJump(2)">2</button>
                    <button class="btn btn-num" onclick="numJump(3)">3</button>
                    <button class="btn btn-num" onclick="numJump(4)">4</button>
                    <button class="btn btn-num" onclick="numJump(5)">5</button>
                    <button class="btn btn-num" onclick="numJump(6)">6</button>
                    <button class="btn btn-num" onclick="numJump(7)">7</button>
                    <button class="btn btn-num" onclick="numJump(8)">8</button>
                    <button class="btn btn-num" onclick="numJump(9)">9</button>
                    <button class="btn btn-num" onclick="numJump(0)">0</button>
                </div>

                <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:15px; margin-top:15px;">
                    <button class="btn" id="prev-btn">|◀◀</button>
                    <button class="btn" id="play-btn">▶ / ||</button>
                    <button class="btn" id="next-btn">▶▶|</button>
                    <button class="btn" id="stop-btn">■</button>
                </div>
            </div>

            <div class="side-panel">
                <div style="display:grid; grid-template-columns: repeat(2, 1fr); gap:8px;">
                    <button class="btn" id="rew-btn">◀◀</button>
                    <button class="btn" id="fwd-btn">▶▶</button>
                    <button class="btn" id="shuffle-btn">Shuffle</button>
                    <button class="btn" id="repeat-btn">Repeat</button>
                    <button class="btn" id="m10-btn">- 10</button>
                    <button class="btn" id="p10-btn">+ 10</button>
                    <button class="btn" id="peak-btn">Peak Search</button>
                    <button class="btn" id="ab-btn">A - B</button>
                    <button class="btn" id="time-btn" style="grid-column: span 2;">Time Mode</button>
                </div>
                <div style="margin-top:15px; text-align:center;">
                    <span style="font-size:10px; color:white; font-weight:bold; text-transform:uppercase; margin-bottom:8px; display:block;">Jog Shuttle</span>
                    <div class="knob jog-knob" id="jog-knob"></div>
                </div>
            </div>
        </div>

        <div style="margin-top: 40px; padding-top: 25px; border-top: 1px solid #222;">
            <div style="text-align: center; width: 100px;">
                <span style="font-size:10px; color:white; font-weight:bold; text-transform:uppercase; margin-bottom:8px; display:block;">Phones Vol</span>
                <div class="knob vol-knob" id="vol-knob"></div>
            </div>
        </div>
    </div>

    <script>
        const audio = new Audio();
        audio.crossOrigin = "anonymous";
        let audioCtx, analyzer, dataArray, playlist = [], currentIndex = 0;
        let currentVol = 2, isShuffle = false, repeatMode = 0, timeMode = 0; 
        let volTimer = null, pointA = null, pointB = null, isPeakSearching = false;
        
        // Multi-digit logic
        let inputBuffer = "";
        let inputTimer = null;

        const gridContainer = document.getElementById('track-grid');
        for(let i=1; i<=20; i++) {
            const span = document.createElement('span');
            span.className = 'grid-num';
            span.id = `gn-${i}`;
            span.innerText = i;
            gridContainer.appendChild(span);
        }

        function updateTrackGrid() {
            for(let i=1; i<=20; i++) {
                const el = document.getElementById(`gn-${i}`);
                el.classList.remove('loaded', 'active-track');
                if (i <= playlist.length) el.classList.add('loaded');
                if (playlist.length > 0 && i === currentIndex + 1) el.classList.add('active-track');
            }
        }

        function savePrefs() {
            const prefs = { volume: currentVol, timeMode: timeMode, language: "en", theme: "dark" };
            localStorage.setItem('technics_prefs', JSON.stringify(prefs));
        }

        function loadPrefs() {
            const saved = localStorage.getItem('technics_prefs');
            if (saved) {
                const prefs = JSON.parse(saved);
                currentVol = prefs.volume || 2;
                timeMode = prefs.timeMode || 0;
                applyPrefs();
            }
        }

        function applyPrefs() {
            audio.volume = currentVol / 100;
            updateDig('v', currentVol);
            volKnob.style.transform = `rotate(${(currentVol / 100 * 300) - 150}deg)`;
            document.getElementById('time-label').innerText = ["Min : Sec", "Remain", "Total Remain"][timeMode];
            document.getElementById('time-sign').classList.toggle('visible', timeMode > 0);
        }

        function updateDig(prefix, value) {
            const val = Math.floor(Math.abs(value)).toString().padStart(2, '0');
            const d1 = document.getElementById(`${prefix}-d1`);
            const d2 = document.getElementById(`${prefix}-d2`);
            if(d1 && d2) { d1.innerText = val[0]; d2.innerText = val[1]; }
        }

        // Logic for 1 + 5 = 15
        function numJump(digit) {
            clearTimeout(inputTimer);
            inputBuffer += digit.toString();
            
            // Show current buffer on track display
            updateDig('t', parseInt(inputBuffer));
            document.getElementById('track-counter-box').classList.add('vfd-blink');

            if (inputBuffer.length >= 2) {
                executeJump();
            } else {
                inputTimer = setTimeout(executeJump, 800); // Wait 800ms for second digit
            }
        }

        function executeJump() {
            let trackNum = parseInt(inputBuffer);
            inputBuffer = "";
            document.getElementById('track-counter-box').classList.remove('vfd-blink');
            
            if (playlist.length >= trackNum && trackNum > 0) {
                loadTrack(trackNum - 1);
            } else {
                // If invalid or track doesn't exist, revert to current track display
                updateDig('t', currentIndex + 1);
            }
        }

        function showVolumeOverlay() {
            document.getElementById('time-group').style.display = 'none';
            document.getElementById('vol-group').style.display = 'block';
            clearTimeout(volTimer);
            volTimer = setTimeout(() => {
                document.getElementById('time-group').style.display = 'block';
                document.getElementById('vol-group').style.display = 'none';
            }, 2000);
        }

        const volKnob = document.getElementById('vol-knob');
        volKnob.onmouseenter = showVolumeOverlay;

        let isVolDown = false, isJogDown = false;
        volKnob.onmousedown = () => isVolDown = true;
        document.getElementById('jog-knob').onmousedown = (e) => { isJogDown = true; e.preventDefault(); };
        window.onmouseup = () => { isVolDown = false; isJogDown = false; savePrefs(); };

        window.onmousemove = (e) => {
            if (isVolDown) {
                currentVol -= e.movementY * 0.5;
                currentVol = Math.max(0, Math.min(100, currentVol));
                audio.volume = currentVol / 100;
                updateDig('v', currentVol);
                volKnob.style.transform = `rotate(${(currentVol / 100 * 300) - 150}deg)`;
                showVolumeOverlay();
            }
            if (isJogDown && playlist.length) {
                document.getElementById('jog-knob').style.transform += `rotate(${e.movementX}deg)`;
                audio.currentTime += e.movementX * 0.1;
            }
        };

        const mL = document.getElementById('meter-L'), mR = document.getElementById('meter-R');
        for(let i=0; i<40; i++) {
            mL.appendChild(document.createElement('div')).className = 'meter-segment';
            mR.appendChild(document.createElement('div')).className = 'meter-segment';
        }

        function setupAudio() {
            if (audioCtx) return;
            audioCtx = new AudioContext();
            const src = audioCtx.createMediaElementSource(audio);
            analyzer = audioCtx.createAnalyser(); analyzer.fftSize = 64;
            src.connect(analyzer); analyzer.connect(audioCtx.destination);
            dataArray = new Uint8Array(analyzer.frequencyBinCount);
            renderVU();
        }

        function renderVU() {
            requestAnimationFrame(renderVU);
            if (!analyzer) return;
            analyzer.getByteFrequencyData(dataArray);
            [mL, mR].forEach((el, idx) => {
                const segs = el.children;
                const active = Math.floor((dataArray[idx+2]/255) * 40);
                for(let i=0; i<40; i++) segs[i].className = 'meter-segment' + (i < active ? (i > 34 ? ' on-red' : ' on-blue') : '');
            });
        }

        document.getElementById('file-input').onchange = (e) => {
            playlist = Array.from(e.target.files);
            if(playlist.length) loadTrack(0);
            document.getElementById('tray-front').classList.remove('open');
        };

        function loadTrack(idx) {
            if (!playlist.length) return;
            currentIndex = Math.max(0, Math.min(idx, playlist.length - 1));
            audio.src = URL.createObjectURL(playlist[currentIndex]);
            updateDig('t', currentIndex + 1);
            updateTrackGrid();
            audio.play().catch(() => {});
            setupAudio();
        }

        document.getElementById('eject-btn').onclick = () => document.getElementById('tray-front').classList.toggle('open');
        document.getElementById('play-btn').onclick = () => { if(playlist.length) audio.paused ? audio.play() : audio.pause(); };
        document.getElementById('stop-btn').onclick = () => { 
            audio.pause(); audio.currentTime = 0; 
            pointA = null; pointB = null; 
            document.getElementById('vfd-ab').classList.remove('active', 'vfd-blink'); 
        };
        
        document.getElementById('next-btn').onclick = () => {
            if (isShuffle) loadTrack(Math.floor(Math.random() * playlist.length));
            else loadTrack(currentIndex + 1);
        };
        document.getElementById('prev-btn').onclick = () => loadTrack(currentIndex - 1);
        
        document.getElementById('p10-btn').onclick = () => { if(playlist.length) audio.currentTime += 10; };
        document.getElementById('m10-btn').onclick = () => { if(playlist.length) audio.currentTime -= 10; };

        document.getElementById('fwd-btn').onclick = () => { audio.currentTime += 5; };
        document.getElementById('rew-btn').onclick = () => { audio.currentTime -= 5; };
        
        document.getElementById('shuffle-btn').onclick = () => {
            isShuffle = !isShuffle;
            document.getElementById('vfd-shuffle').classList.toggle('active', isShuffle);
        };

        document.getElementById('repeat-btn').onclick = () => {
            repeatMode = (repeatMode + 1) % 3;
            document.getElementById('vfd-repeat-1').classList.toggle('active', repeatMode === 1);
            document.getElementById('vfd-repeat-all').classList.toggle('active', repeatMode === 2);
        };

        document.getElementById('time-btn').onclick = () => {
            timeMode = (timeMode + 1) % 3;
            applyPrefs();
            savePrefs();
        };

        document.getElementById('peak-btn').onclick = async () => {
            if (!playlist.length || isPeakSearching) return;
            isPeakSearching = true;
            const peakVfd = document.getElementById('vfd-peak');
            peakVfd.classList.add('vfd-blink');
            let originalPos = audio.currentTime;
            for(let i=0; i<8; i++) {
                audio.currentTime = (audio.duration / 8) * i;
                await new Promise(r => setTimeout(r, 150));
            }
            audio.currentTime = originalPos;
            peakVfd.classList.remove('vfd-blink');
            peakVfd.classList.add('active');
            setTimeout(() => peakVfd.classList.remove('active'), 3000);
            isPeakSearching = false;
        };

        document.getElementById('ab-btn').onclick = () => {
            if (!playlist.length) return;
            const abVfd = document.getElementById('vfd-ab');
            if (pointA === null) { pointA = audio.currentTime; abVfd.classList.add('vfd-blink'); }
            else if (pointB === null) { pointB = audio.currentTime; abVfd.classList.remove('vfd-blink'); abVfd.classList.add('active'); }
            else { pointA = null; pointB = null; abVfd.classList.remove('active', 'vfd-blink'); }
        };

        audio.onpause = () => document.getElementById('main-time-display').classList.add('vfd-blink');
        audio.onplay = () => document.getElementById('main-time-display').classList.remove('vfd-blink');
        
        audio.onended = () => {
            if (repeatMode === 1) audio.play();
            else if (isShuffle) loadTrack(Math.floor(Math.random() * playlist.length));
            else if (repeatMode === 2 || currentIndex < playlist.length - 1) loadTrack(currentIndex + 1);
        };

        audio.ontimeupdate = () => {
            let t = audio.currentTime;
            if (timeMode === 1) t = Math.max(0, audio.duration - audio.currentTime);
            else if (timeMode === 2) {
                let remainTracks = playlist.length - 1 - currentIndex;
                t = Math.max(0, audio.duration - audio.currentTime) + (remainTracks * 180);
            }
            updateDig('m', t / 60); updateDig('s', t % 60);
            if (pointA !== null && pointB !== null && audio.currentTime >= pointB) audio.currentTime = pointA;
        };

        loadPrefs();
        updateTrackGrid();
    </script>
</body>
</html>
